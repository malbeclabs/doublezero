syntax = "proto3";

package controller;

option go_package = "github.com/malbeclabs/doublezero/controlplane/proto/controller";


service Controller {
    // Returns the latest configuration of a DoubleZero node based on on-chain data
    rpc GetConfig (ConfigRequest) returns (ConfigResponse) {}
    // Returns only the hash of the latest configuration (lightweight check for changes)
    rpc GetConfigHash (ConfigRequest) returns (ConfigHashResponse) {}
}

// Request for latest configuration of a DoubleZero node based on its public key
message ConfigRequest {
    string pubkey = 1;
    repeated string bgp_peers = 2;
    string hash = 3;
    map<string, BgpPeers> bgp_peers_by_vrf = 4;
    optional string agent_version = 5;
    optional string agent_commit = 6;
    optional string agent_date = 7;
}

// Represents a list of BGP peers
message BgpPeers {
    repeated string peers = 1;
}

// Response containing the latest configuration of a DoubleZero node
message ConfigResponse {
    string config = 1;
    string hash = 2;
}

// Response containing only the config hash
message ConfigHashResponse {
    string hash = 1;
}