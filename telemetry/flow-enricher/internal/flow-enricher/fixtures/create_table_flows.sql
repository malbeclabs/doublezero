CREATE TABLE default.flows_integration
(
    `as_path` Array(String) CODEC(ZSTD(1)),
    `bgp_communities` Array(String) CODEC(ZSTD(1)),
    `bgp_next_hop` String,
    `bytes` UInt64 CODEC(Delta, LZ4),
    `dst_addr` String,
    `dst_as` UInt32,
    `dst_mac` String,
    `dst_net` String,
    `dst_port` UInt16,
    `dst_vlan` UInt16,
    `etype` LowCardinality(String),
    `forwarding_status` UInt8,
    `fragment_id` UInt32,
    `fragment_offset` UInt16,
    `icmp_code` UInt8,
    `icmp_type` UInt8,
    `in_if` Int64,
    `in_ifname` LowCardinality(String),
    `ip_flags` UInt8,
    `ip_tos` UInt8,
    `ip_ttl` UInt8,
    `ipv6_flow_label` UInt32,
    `ipv6_routing_header_addresses` Array(String) CODEC(ZSTD(1)),
    `ipv6_routing_header_seg_left` UInt8,
    `layer_size` Array(Int64) CODEC(ZSTD(1)),
    `layer_stack` Array(String) CODEC(ZSTD(1)),
    `mpls_ip` Array(String) CODEC(ZSTD(1)),
    `mpls_label` Array(String) CODEC(ZSTD(1)),
    `mpls_ttl` Array(String) CODEC(ZSTD(1)),
    `next_hop` String,
    `next_hop_as` UInt32,
    `observation_domain_id` UInt32,
    `observation_point_id` UInt32,
    `out_if` Int64,
    `out_ifname` LowCardinality(String),
    `packets` UInt32 CODEC(Delta, LZ4),
    `proto` LowCardinality(String),
    `sampler_address` LowCardinality(String),
    `sampling_rate` UInt32,
    `sequence_num` UInt32 CODEC(Delta, LZ4),
    `src_addr` String,
    `src_as` UInt32,
    `src_mac` String,
    `src_net` String,
    `src_port` UInt16,
    `src_vlan` UInt16,
    `tcp_flags` UInt8,
    `time_flow_end_ns` DateTime64(9) CODEC(DoubleDelta, LZ4),
    `time_flow_start_ns` DateTime64(9) CODEC(DoubleDelta, LZ4),
    `time_received_ns` DateTime64(9) CODEC(DoubleDelta, LZ4),
    `type` LowCardinality(String),
    `vlan_id` UInt16,
    `src_device_code` LowCardinality(String),
    `dst_device_code` LowCardinality(String),
    `src_location` LowCardinality(String),
    `dst_location` LowCardinality(String),
    `src_exchange` LowCardinality(String),
    `dst_exchange` LowCardinality(String)
)
ENGINE = MergeTree
PARTITION BY toYYYYMM(time_received_ns)
ORDER BY (time_received_ns, sampler_address, etype, proto, in_ifname, out_ifname, src_as, dst_as, sampling_rate)
SETTINGS index_granularity = 8192;
