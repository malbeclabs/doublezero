{
    "annotations": {
        "list": [
            {
                "builtIn": 1,
                "datasource": {
                    "type": "grafana",
                    "uid": "doublezero-lake"
                },
                "enable": true,
                "hide": true,
                "iconColor": "rgba(0, 211, 255, 1)",
                "name": "Annotations & Alerts",
                "type": "dashboard"
            }
        ]
    },
    "editable": true,
    "fiscalYearStartMonth": 0,
    "graphTooltip": 0,
    "id": null,
    "links": [],
    "liveNow": false,
    "panels": [
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "gridPos": {
                "h": 2,
                "w": 24,
                "x": 0,
                "y": 0
            },
            "id": 18,
            "options": {
                "code": {
                    "language": "markdown",
                    "showLineNumbers": false,
                    "showMiniMap": false
                },
                "content": "[ðŸ“Š Devices Overview](/d/doublezero-devices-overview) | [ðŸ‘¥ Users Overview](/d/doublezero-users-overview)"
            },
            "pluginVersion": "10.0.0",
            "title": "",
            "type": "text"
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "short"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 3,
                "x": 0,
                "y": 2
            },
            "id": 4,
            "options": {
                "colorMode": "value",
                "graphMode": "area",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "10.0.0",
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "table",
                    "rawQuery": true,
                    "rawSql": "SELECT COUNT(*) as value FROM dz_devices_current",
                    "refId": "A"
                }
            ],
            "title": "Total Devices",
            "type": "stat",
            "links": [
                {
                    "asDropdown": false,
                    "icon": "external link",
                    "includeVars": true,
                    "keepTime": true,
                    "tags": [],
                    "targetBlank": false,
                    "title": "View Devices Dashboard",
                    "tooltip": "Drill down to device details",
                    "type": "link",
                    "url": "/d/doublezero-devices-overview"
                }
            ]
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "short"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 3,
                "x": 3,
                "y": 2
            },
            "id": 5,
            "options": {
                "colorMode": "value",
                "graphMode": "area",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "10.0.0",
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "table",
                    "rawQuery": true,
                    "rawSql": "SELECT COUNT(*) as value FROM dz_links_current",
                    "refId": "A"
                }
            ],
            "title": "Total Links",
            "type": "stat",
            "links": [
                {
                    "asDropdown": false,
                    "icon": "external link",
                    "includeVars": true,
                    "keepTime": true,
                    "tags": [],
                    "targetBlank": false,
                    "title": "View Devices Dashboard",
                    "tooltip": "Drill down to link details",
                    "type": "link",
                    "url": "/d/doublezero-devices-overview"
                }
            ]
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "short"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 3,
                "x": 6,
                "y": 2
            },
            "id": 19,
            "options": {
                "colorMode": "value",
                "graphMode": "area",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "10.0.0",
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "table",
                    "rawQuery": true,
                    "rawSql": "SELECT COUNT(*) as value FROM dz_links_current WHERE status = 'activated' AND CAST(COALESCE(isis_delay_override_ns, 0) AS BIGINT) != CAST(1000000000 AS BIGINT)",
                    "refId": "A"
                }
            ],
            "title": "Activated Links",
            "type": "stat"
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "short"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 3,
                "x": 9,
                "y": 2
            },
            "id": 6,
            "options": {
                "colorMode": "value",
                "graphMode": "area",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "10.0.0",
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "table",
                    "rawQuery": true,
                    "rawSql": "SELECT COUNT(*) as value FROM dz_metros_current",
                    "refId": "A"
                }
            ],
            "title": "Metros",
            "type": "stat"
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "short"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 3,
                "x": 12,
                "y": 2
            },
            "id": 7,
            "options": {
                "colorMode": "value",
                "graphMode": "area",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "10.0.0",
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "table",
                    "rawQuery": true,
                    "rawSql": "SELECT COUNT(*) as value FROM dz_contributors_current",
                    "refId": "A"
                }
            ],
            "title": "Contributors",
            "type": "stat"
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "short"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 3,
                "x": 15,
                "y": 2
            },
            "id": 20,
            "options": {
                "colorMode": "value",
                "graphMode": "area",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "10.0.0",
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "table",
                    "rawQuery": true,
                    "rawSql": "SELECT COUNT(*) as value FROM dz_users_current",
                    "refId": "A"
                }
            ],
            "title": "Total Users",
            "type": "stat",
            "links": [
                {
                    "asDropdown": false,
                    "icon": "external link",
                    "includeVars": true,
                    "keepTime": true,
                    "tags": [],
                    "targetBlank": false,
                    "title": "View Users Dashboard",
                    "tooltip": "Drill down to user details",
                    "type": "link",
                    "url": "/d/doublezero-users-overview"
                }
            ]
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "short"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 3,
                "x": 18,
                "y": 2
            },
            "id": 21,
            "options": {
                "colorMode": "value",
                "graphMode": "area",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "10.0.0",
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "table",
                    "rawQuery": true,
                    "rawSql": "SELECT COUNT(*) as value FROM dz_users_current WHERE status = 'activated'",
                    "refId": "A"
                }
            ],
            "title": "Active Users",
            "type": "stat",
            "links": [
                {
                    "asDropdown": false,
                    "icon": "external link",
                    "includeVars": true,
                    "keepTime": true,
                    "tags": [],
                    "targetBlank": false,
                    "title": "View Users Dashboard",
                    "tooltip": "Drill down to user details",
                    "type": "link",
                    "url": "/d/doublezero-users-overview"
                }
            ]
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "short"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 3,
                "x": 21,
                "y": 2
            },
            "id": 22,
            "options": {
                "colorMode": "value",
                "graphMode": "area",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "10.0.0",
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "table",
                    "rawQuery": true,
                    "rawSql": "SELECT COUNT(*) as value FROM dz_users_current WHERE (kind = 'ibrl' OR kind = 'ibrl_with_allocated_ip')",
                    "refId": "A"
                }
            ],
            "title": "IBRL Users",
            "type": "stat",
            "links": [
                {
                    "asDropdown": false,
                    "icon": "external link",
                    "includeVars": true,
                    "keepTime": true,
                    "tags": [],
                    "targetBlank": false,
                    "title": "View Users Dashboard",
                    "tooltip": "Drill down to user details",
                    "type": "link",
                    "url": "/d/doublezero-users-overview"
                }
            ]
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "bps"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 6,
                "x": 0,
                "y": 6
            },
            "id": 23,
            "options": {
                "colorMode": "value",
                "graphMode": "none",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto",
                "description": "Total WAN link bandwidth capacity and utilization percentage. Only includes WAN links (inter-metro, not in the same metro)."
            },
            "pluginVersion": "10.0.0",
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "table",
                    "rawQuery": true,
                    "rawSql": "SELECT\n  CAST(COALESCE(SUM(l.bandwidth_bps), 0) AS DOUBLE) as \"Total Capacity (bps)\",\n  CASE\n    WHEN SUM(l.bandwidth_bps) > 0 THEN CAST((COALESCE(MAX(peak_throughput.peak_throughput), 0) / SUM(l.bandwidth_bps) * 100.0) AS DOUBLE)\n    ELSE 0.0\n  END as \"Utilization %\"\nFROM dz_links_current l\nJOIN dz_devices_current da ON l.side_a_pk = da.pk\nJOIN dz_devices_current dz ON l.side_z_pk = dz.pk\nLEFT JOIN dz_metros_current ma ON da.metro_pk = ma.pk\nLEFT JOIN dz_metros_current mz ON dz.metro_pk = mz.pk\nLEFT JOIN (\n  SELECT\n    u.link_pk,\n    MAX((u.in_octets_delta + u.out_octets_delta) * 8.0 / NULLIF(u.delta_duration, 0)) as peak_throughput\n  FROM dz_device_iface_usage_raw u\n  WHERE\n    u.time >= $__timeFrom()\n    AND u.time <= $__timeTo()\n    AND u.delta_duration > 0\n    AND u.in_octets_delta >= 0\n    AND u.out_octets_delta >= 0\n    AND u.link_pk IS NOT NULL\n  GROUP BY u.link_pk\n) peak_throughput ON peak_throughput.link_pk = l.pk\nWHERE\n  l.link_type = 'WAN'\n  AND ma.pk != mz.pk",
                    "refId": "A"
                }
            ],
            "title": "WAN Capacity & Utilization",
            "type": "stat",
            "links": [
                {
                    "asDropdown": false,
                    "icon": "external link",
                    "includeVars": true,
                    "keepTime": true,
                    "tags": [],
                    "targetBlank": false,
                    "title": "View Devices Dashboard",
                    "tooltip": "Drill down to link details",
                    "type": "link",
                    "url": "/d/doublezero-devices-overview"
                }
            ]
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "bps"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 6,
                "x": 6,
                "y": 6
            },
            "id": 24,
            "options": {
                "colorMode": "value",
                "graphMode": "none",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "10.0.0",
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "table",
                    "rawQuery": true,
                    "rawSql": "SELECT CAST(COALESCE(AVG((u.in_octets_delta + u.out_octets_delta) * 8.0 / NULLIF(u.delta_duration, 0)), 0) AS DOUBLE) as value FROM dz_device_iface_usage_raw u WHERE u.time >= $__timeFrom() AND u.time <= $__timeTo() AND u.delta_duration > 0 AND u.in_octets_delta >= 0 AND u.out_octets_delta >= 0",
                    "refId": "A"
                }
            ],
            "title": "Avg Throughput",
            "type": "stat"
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "bps"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 4,
                "w": 6,
                "x": 12,
                "y": 6
            },
            "id": 25,
            "options": {
                "colorMode": "value",
                "graphMode": "none",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "10.0.0",
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "table",
                    "rawQuery": true,
                    "rawSql": "SELECT CAST(COALESCE(MAX((u.in_octets_delta + u.out_octets_delta) * 8.0 / NULLIF(u.delta_duration, 0)), 0) AS DOUBLE) as value FROM dz_device_iface_usage_raw u WHERE u.time >= $__timeFrom() AND u.time <= $__timeTo() AND u.delta_duration > 0 AND u.in_octets_delta >= 0 AND u.out_octets_delta >= 0",
                    "refId": "A"
                }
            ],
            "title": "Peak Throughput",
            "type": "stat"
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "short"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 0,
                "y": 10
            },
            "id": 9,
            "options": {
                "legend": {
                    "calcs": [
                        "mean",
                        "lastNotNull"
                    ],
                    "displayMode": "table",
                    "placement": "bottom",
                    "showLegend": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "none"
                }
            },
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "time_series",
                    "rawQuery": true,
                    "rawSql": "SELECT\n  date_trunc('minute', time) as time,\n  AVG(rtt_us / 1000.0) as \"Average RTT (ms)\"\nFROM dz_device_link_latency_samples_raw\nWHERE\n  time >= $__timeFrom()\n  AND time <= $__timeTo()\n  AND rtt_us > 0\nGROUP BY date_trunc('minute', time)\nORDER BY time",
                    "refId": "A",
                    "sql": {
                        "columns": [
                            {
                                "parameters": [],
                                "type": "function"
                            }
                        ],
                        "groupBy": [
                            {
                                "property": {
                                    "type": "string"
                                },
                                "type": "groupBy"
                            }
                        ],
                        "limit": 50
                    }
                }
            ],
            "title": "DZ Network Latency (Device-to-Device)",
            "type": "timeseries"
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "axisCenteredZero": false,
                        "axisColorMode": "text",
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "drawStyle": "line",
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "hideFrom": {
                            "tooltip": false,
                            "viz": false,
                            "legend": false
                        },
                        "lineInterpolation": "linear",
                        "lineWidth": 1,
                        "pointSize": 5,
                        "scaleDistribution": {
                            "type": "linear"
                        },
                        "showPoints": "never",
                        "spanNulls": false,
                        "stacking": {
                            "group": "A",
                            "mode": "none"
                        },
                        "thresholdsStyle": {
                            "mode": "off"
                        }
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "Bps"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 12,
                "y": 10
            },
            "id": 10,
            "options": {
                "legend": {
                    "calcs": [
                        "mean",
                        "lastNotNull"
                    ],
                    "displayMode": "table",
                    "placement": "bottom",
                    "showLegend": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "none"
                }
            },
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "time_series",
                    "rawQuery": true,
                    "rawSql": "SELECT\n  date_trunc('minute', time_bucket) as time,\n  AVG(total_throughput) as \"Total Throughput (bps)\"\nFROM (\n  SELECT\n    time as time_bucket,\n    SUM((in_octets_delta + out_octets_delta) * 8.0 / NULLIF(delta_duration, 0)) as total_throughput\n  FROM dz_device_iface_usage_raw\n  WHERE\n    time >= $__timeFrom()\n    AND time <= $__timeTo()\n    AND delta_duration > 0\n    AND in_octets_delta >= 0\n    AND out_octets_delta >= 0\n  GROUP BY time\n) subq\nGROUP BY date_trunc('minute', time_bucket)\nORDER BY time",
                    "refId": "A",
                    "sql": {
                        "columns": [
                            {
                                "parameters": [],
                                "type": "function"
                            }
                        ],
                        "groupBy": [
                            {
                                "property": {
                                    "type": "string"
                                },
                                "type": "groupBy"
                            }
                        ],
                        "limit": 50
                    }
                }
            ],
            "title": "Network Throughput",
            "type": "timeseries"
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            },
                            {
                                "color": "red",
                                "value": 1
                            }
                        ]
                    },
                    "unit": "short",
                    "nullValueMode": "null"
                },
                "overrides": [
                    {
                        "matcher": {
                            "id": "byName",
                            "options": "Interface Errors"
                        },
                        "properties": [
                            {
                                "id": "displayName",
                                "value": "Interface Errors"
                            }
                        ]
                    },
                    {
                        "matcher": {
                            "id": "byName",
                            "options": "Interface Discards"
                        },
                        "properties": [
                            {
                                "id": "displayName",
                                "value": "Interface Discards"
                            }
                        ]
                    }
                ]
            },
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 0,
                "y": 18
            },
            "id": 11,
            "options": {
                "colorMode": "value",
                "graphMode": "none",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "/Interface Errors|Interface Discards/",
                    "values": false
                },
                "textMode": "auto",
                "noValue": "0"
            },
            "pluginVersion": "10.0.0",
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "table",
                    "rawQuery": true,
                    "rawSql": "SELECT\n  CAST(COALESCE((\n    SELECT SUM(GREATEST(COALESCE(in_errors_delta, 0), 0) + GREATEST(COALESCE(out_errors_delta, 0), 0))\n    FROM dz_device_iface_usage_raw\n    WHERE time >= $__timeFrom() AND time <= $__timeTo() AND delta_duration > 0\n  ), 0) AS BIGINT) as \"Interface Errors\",\n  CAST(COALESCE((\n    SELECT SUM(GREATEST(COALESCE(in_discards_delta, 0), 0) + GREATEST(COALESCE(out_discards_delta, 0), 0))\n    FROM dz_device_iface_usage_raw\n    WHERE time >= $__timeFrom() AND time <= $__timeTo() AND delta_duration > 0\n  ), 0) AS BIGINT) as \"Interface Discards\"",
                    "refId": "A",
                    "sql": {
                        "columns": [
                            {
                                "parameters": [],
                                "type": "function"
                            }
                        ],
                        "groupBy": [
                            {
                                "property": {
                                    "type": "string"
                                },
                                "type": "groupBy"
                            }
                        ],
                        "limit": 50
                    }
                }
            ],
            "title": "Interface Errors & Discards (Last 24h)",
            "type": "stat"
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "short"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 12,
                "y": 18
            },
            "id": 12,
            "options": {
                "colorMode": "value",
                "graphMode": "none",
                "justifyMode": "auto",
                "orientation": "auto",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "textMode": "auto"
            },
            "pluginVersion": "10.0.0",
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "table",
                    "rawQuery": true,
                    "rawSql": "SELECT\n  COUNT(DISTINCT pubkey) as \"Gossip Nodes\",\n  COUNT(DISTINCT CASE WHEN va.epoch_vote_account = true AND va.activated_stake_lamports > 0 THEN va.vote_pubkey END) as \"Staked Validators\"\nFROM solana_gossip_nodes_current gn\nLEFT JOIN solana_vote_accounts_current va ON gn.pubkey = va.node_pubkey",
                    "refId": "A",
                    "sql": {
                        "columns": [
                            {
                                "parameters": [],
                                "type": "function"
                            }
                        ],
                        "groupBy": [
                            {
                                "property": {
                                    "type": "string"
                                },
                                "type": "groupBy"
                            }
                        ],
                        "limit": 50
                    }
                }
            ],
            "title": "Solana Network Stats",
            "type": "stat"
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "axisCenteredZero": false,
                        "axisColorMode": "text",
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "drawStyle": "line",
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "hideFrom": {
                            "tooltip": false,
                            "viz": false,
                            "legend": false
                        },
                        "lineInterpolation": "linear",
                        "lineWidth": 1,
                        "pointSize": 5,
                        "scaleDistribution": {
                            "type": "linear"
                        },
                        "showPoints": "never",
                        "spanNulls": false,
                        "stacking": {
                            "group": "A",
                            "mode": "none"
                        },
                        "thresholdsStyle": {
                            "mode": "off"
                        }
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "ms"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 0,
                "y": 26
            },
            "id": 13,
            "options": {
                "legend": {
                    "calcs": [
                        "mean",
                        "lastNotNull"
                    ],
                    "displayMode": "table",
                    "placement": "bottom",
                    "showLegend": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "none"
                }
            },
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "time_series",
                    "rawQuery": true,
                    "rawSql": "SELECT\n  date_trunc('minute', l.time) as time,\n  CONCAT(mo.code, ' â†’ ', mt.code) as \"Metro Pair\",\n  AVG(l.rtt_us / 1000.0) as \"RTT (ms)\"\nFROM dz_device_link_latency_samples_raw l\nJOIN dz_devices_current dev_o ON l.origin_device_pk = dev_o.pk\nJOIN dz_devices_current dev_t ON l.target_device_pk = dev_t.pk\nJOIN dz_metros_current mo ON dev_o.metro_pk = mo.pk\nJOIN dz_metros_current mt ON dev_t.metro_pk = mt.pk\nWHERE\n  l.time >= $__timeFrom()\n  AND l.time <= $__timeTo()\n  AND l.rtt_us > 0\n  AND mo.code < mt.code\nGROUP BY date_trunc('minute', l.time), mo.code, mt.code\nORDER BY time, \"Metro Pair\"",
                    "refId": "A"
                }
            ],
            "title": "Latency by Metro Pair",
            "type": "timeseries"
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "custom": {
                        "align": "auto",
                        "cellOptions": {
                            "type": "auto"
                        },
                        "inspect": false
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    }
                },
                "overrides": []
            },
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 12,
                "y": 26
            },
            "id": 14,
            "options": {
                "cellHeight": "sm",
                "footer": {
                    "countRows": false,
                    "fields": "",
                    "reducer": [
                        "sum"
                    ],
                    "show": false
                },
                "showHeader": true,
                "sortBy": [
                    {
                        "desc": true,
                        "displayName": "Total Errors"
                    }
                ]
            },
            "pluginVersion": "10.0.0",
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "table",
                    "rawQuery": true,
                    "rawSql": "SELECT\n  d.code as \"Device\",\n  m.code as \"Metro\",\n  SUM(GREATEST(COALESCE(u.in_errors_delta, 0), 0) + GREATEST(COALESCE(u.out_errors_delta, 0), 0)) as \"Total Errors\",\n  SUM(GREATEST(COALESCE(u.in_discards_delta, 0), 0) + GREATEST(COALESCE(u.out_discards_delta, 0), 0)) as \"Total Discards\"\nFROM dz_device_iface_usage_raw u\nJOIN dz_devices_current d ON u.device_pk = d.pk\nJOIN dz_metros_current m ON d.metro_pk = m.pk\nWHERE\n  u.time >= $__timeFrom()\n  AND u.time <= $__timeTo()\n  AND u.delta_duration > 0\nGROUP BY d.code, m.code\nHAVING SUM(GREATEST(COALESCE(u.in_errors_delta, 0), 0) + GREATEST(COALESCE(u.out_errors_delta, 0), 0)) > 0\nORDER BY \"Total Errors\" DESC\nLIMIT 10",
                    "refId": "A"
                }
            ],
            "title": "Top Devices by Errors",
            "type": "table"
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "axisCenteredZero": false,
                        "axisColorMode": "text",
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "drawStyle": "line",
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "hideFrom": {
                            "tooltip": false,
                            "viz": false,
                            "legend": false
                        },
                        "lineInterpolation": "linear",
                        "lineWidth": 1,
                        "pointSize": 5,
                        "scaleDistribution": {
                            "type": "linear"
                        },
                        "showPoints": "never",
                        "spanNulls": false,
                        "stacking": {
                            "group": "A",
                            "mode": "none"
                        },
                        "thresholdsStyle": {
                            "mode": "off"
                        }
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "Bps"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 0,
                "y": 34
            },
            "id": 15,
            "options": {
                "legend": {
                    "calcs": [
                        "mean",
                        "lastNotNull"
                    ],
                    "displayMode": "table",
                    "placement": "bottom",
                    "showLegend": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "none"
                }
            },
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "time_series",
                    "rawQuery": true,
                    "rawSql": "SELECT\n  date_trunc('minute', time_bucket) as time,\n  link_type as \"Link Type\",\n  AVG(total_throughput) as \"Throughput (bps)\"\nFROM (\n  SELECT\n    u.time as time_bucket,\n    l.link_type,\n    SUM((u.in_octets_delta + u.out_octets_delta) * 8.0 / NULLIF(u.delta_duration, 0)) as total_throughput\n  FROM dz_device_iface_usage_raw u\n  JOIN dz_links_current l ON u.link_pk = l.pk\n  WHERE\n    u.time >= $__timeFrom()\n    AND u.time <= $__timeTo()\n    AND u.delta_duration > 0\n    AND u.in_octets_delta >= 0\n    AND u.out_octets_delta >= 0\n    AND l.link_type IS NOT NULL\n  GROUP BY u.time, l.link_type\n) subq\nGROUP BY date_trunc('minute', time_bucket), link_type\nORDER BY time, \"Link Type\"",
                    "refId": "A"
                }
            ],
            "title": "Throughput by Link Type",
            "type": "timeseries"
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "axisCenteredZero": false,
                        "axisColorMode": "text",
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "drawStyle": "line",
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "hideFrom": {
                            "tooltip": false,
                            "viz": false,
                            "legend": false
                        },
                        "lineInterpolation": "linear",
                        "lineWidth": 1,
                        "pointSize": 5,
                        "scaleDistribution": {
                            "type": "linear"
                        },
                        "showPoints": "never",
                        "spanNulls": false,
                        "stacking": {
                            "group": "A",
                            "mode": "none"
                        },
                        "thresholdsStyle": {
                            "mode": "off"
                        }
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "percent"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 8,
                "w": 12,
                "x": 12,
                "y": 34
            },
            "id": 16,
            "options": {
                "legend": {
                    "calcs": [
                        "mean",
                        "lastNotNull"
                    ],
                    "displayMode": "table",
                    "placement": "bottom",
                    "showLegend": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "none"
                }
            },
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "time_series",
                    "rawQuery": true,
                    "rawSql": "SELECT\n  date_trunc('minute', time) as time,\n  (COUNT(CASE WHEN rtt_us = 0 THEN 1 END) * 100.0 / COUNT(*)) as \"Packet Loss %\"\nFROM dz_device_link_latency_samples_raw\nWHERE\n  time >= $__timeFrom()\n  AND time <= $__timeTo()\nGROUP BY date_trunc('minute', time)\nORDER BY time",
                    "refId": "A"
                }
            ],
            "title": "Packet Loss Rate",
            "type": "timeseries"
        },
        {
            "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "axisCenteredZero": false,
                        "axisColorMode": "text",
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "drawStyle": "line",
                        "fillOpacity": 10,
                        "gradientMode": "none",
                        "hideFrom": {
                            "tooltip": false,
                            "viz": false,
                            "legend": false
                        },
                        "lineInterpolation": "linear",
                        "lineWidth": 1,
                        "pointSize": 5,
                        "scaleDistribution": {
                            "type": "linear"
                        },
                        "showPoints": "never",
                        "spanNulls": false,
                        "stacking": {
                            "group": "A",
                            "mode": "none"
                        },
                        "thresholdsStyle": {
                            "mode": "off"
                        }
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green",
                                "value": null
                            }
                        ]
                    },
                    "unit": "ms"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 8,
                "w": 24,
                "x": 0,
                "y": 42
            },
            "id": 17,
            "options": {
                "legend": {
                    "calcs": [
                        "mean",
                        "lastNotNull"
                    ],
                    "displayMode": "table",
                    "placement": "bottom",
                    "showLegend": true
                },
                "tooltip": {
                    "mode": "multi",
                    "sort": "none"
                }
            },
            "targets": [
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "time_series",
                    "rawQuery": true,
                    "rawSql": "SELECT\n  date_trunc('minute', l.time) as time,\n  CONCAT(mo.code, ' â†’ ', mt.code) as \"Metro Pair\",\n  AVG(l.rtt_us / 1000.0) as \"DZ Network RTT (ms)\"\nFROM dz_device_link_latency_samples_raw l\nJOIN dz_devices_current dev_o ON l.origin_device_pk = dev_o.pk\nJOIN dz_devices_current dev_t ON l.target_device_pk = dev_t.pk\nJOIN dz_metros_current mo ON dev_o.metro_pk = mo.pk\nJOIN dz_metros_current mt ON dev_t.metro_pk = mt.pk\nJOIN dz_links_current link ON l.link_pk = link.pk\nWHERE\n  l.time >= $__timeFrom()\n  AND l.time <= $__timeTo()\n  AND l.rtt_us > 0\n  AND link.link_type = 'WAN'\n  AND mo.code < mt.code\nGROUP BY date_trunc('minute', l.time), mo.code, mt.code\nORDER BY time, \"Metro Pair\"",
                    "refId": "A"
                },
                {
                    "datasource": {
                        "type": "postgres",
                        "uid": "doublezero-lake"
                    },
                    "editorMode": "code",
                    "format": "time_series",
                    "rawQuery": true,
                    "rawSql": "SELECT\n  date_trunc('minute', i.time) as time,\n  CONCAT(mo.code, ' â†’ ', mt.code) as \"Metro Pair\",\n  AVG(i.rtt_us / 1000.0) as \"Internet RTT (ms)\"\nFROM dz_internet_metro_latency_samples_raw i\nJOIN dz_metros_current mo ON i.origin_metro_pk = mo.pk\nJOIN dz_metros_current mt ON i.target_metro_pk = mt.pk\nWHERE\n  i.time >= $__timeFrom()\n  AND i.time <= $__timeTo()\n  AND mo.code < mt.code\nGROUP BY date_trunc('minute', i.time), mo.code, mt.code\nORDER BY time, \"Metro Pair\"",
                    "refId": "B"
                }
            ],
            "title": "DZ Network vs Internet Latency (WAN Links Only)",
            "type": "timeseries"
        }
    ],
    "refresh": "30s",
    "schemaVersion": 38,
    "style": "dark",
    "tags": [
        "doublezero",
        "lake",
        "overview"
    ],
    "templating": {
        "list": []
    },
    "time": {
        "from": "now-24h",
        "to": "now"
    },
    "timepicker": {},
    "timezone": "",
    "title": "DoubleZero Overview",
    "uid": "doublezero-lake-overview",
    "version": 0,
    "weekStart": ""
}