{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "doublezero-lake"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": 3,
  "links": [],
  "panels": [
    {
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": {
        "h": 2,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "code": {
          "language": "markdown",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "[â† Back to Overview](/d/doublezero-lake-overview) | [Clear All Filters](/d/doublezero-users-overview?var-user_type=__ALL__&var-status=__ALL__&var-device=__ALL__&var-metro=__ALL__&var-contributor=__ALL__&var-owner_pubkey=__ALL__)",
        "mode": "markdown"
      },
      "pluginVersion": "12.3.1",
      "title": "",
      "type": "text"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 0,
        "y": 2
      },
      "id": 2,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT COUNT(*) as value FROM dz_users_current u LEFT JOIN dz_devices_current d ON u.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE u.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END)",
          "refId": "A"
        }
      ],
      "title": "Total Users",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 3,
        "y": 2
      },
      "id": 3,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT COUNT(*) as value FROM dz_users_current u LEFT JOIN dz_devices_current d ON u.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE (u.kind = 'ibrl' OR u.kind = 'ibrl_with_allocated_ip') AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE u.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END)",
          "refId": "A"
        }
      ],
      "title": "Total IBRL Users",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 6,
        "y": 2
      },
      "id": 18,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT COUNT(*) as value FROM dz_users_current u LEFT JOIN dz_devices_current d ON u.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE u.kind = 'ibrl_with_allocated_ip' AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE u.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END)",
          "refId": "A"
        }
      ],
      "title": "IBRL with IP",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 9,
        "y": 2
      },
      "id": 4,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT COUNT(*) as value FROM dz_users_current u LEFT JOIN dz_devices_current d ON u.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE u.kind = 'multicast' AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE u.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END)",
          "refId": "A"
        }
      ],
      "title": "Multicast Users",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Peak"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Peak"
              },
              {
                "id": "unit",
                "value": "bps"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Avg"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Avg"
              },
              {
                "id": "unit",
                "value": "bps"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 12,
        "y": 2
      },
      "id": 7,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": true
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT CAST(COALESCE(AVG((u.in_octets_delta + u.out_octets_delta) * 8.0 / NULLIF(u.delta_duration, 0)), 0) AS DOUBLE) as \"Avg\", CAST(COALESCE(MAX((u.in_octets_delta + u.out_octets_delta) * 8.0 / NULLIF(u.delta_duration, 0)), 0) AS DOUBLE) as \"Peak\" FROM dz_device_interface_counters_raw u JOIN dz_users_current usr ON u.device_pk = usr.device_pk AND u.user_tunnel_id = usr.tunnel_id LEFT JOIN dz_devices_current d ON usr.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE u.time >= $__timeFrom() AND u.time <= $__timeTo() AND u.delta_duration > 0 AND u.in_octets_delta >= 0 AND u.out_octets_delta >= 0 AND (usr.kind = 'ibrl' OR usr.kind = 'ibrl_with_allocated_ip') AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE usr.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE usr.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE usr.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END)",
          "refId": "A"
        }
      ],
      "title": "IBRL Users Throughput",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Peak"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Peak"
              },
              {
                "id": "unit",
                "value": "bps"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Avg"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Avg"
              },
              {
                "id": "unit",
                "value": "bps"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 18,
        "y": 2
      },
      "id": 8,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": true
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT CAST(COALESCE(AVG((u.in_octets_delta + u.out_octets_delta) * 8.0 / NULLIF(u.delta_duration, 0)), 0) AS DOUBLE) as \"Avg\", CAST(COALESCE(MAX((u.in_octets_delta + u.out_octets_delta) * 8.0 / NULLIF(u.delta_duration, 0)), 0) AS DOUBLE) as \"Peak\" FROM dz_device_interface_counters_raw u JOIN dz_users_current usr ON u.device_pk = usr.device_pk AND u.user_tunnel_id = usr.tunnel_id LEFT JOIN dz_devices_current d ON usr.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE u.time >= $__timeFrom() AND u.time <= $__timeTo() AND u.delta_duration > 0 AND u.in_octets_delta >= 0 AND u.out_octets_delta >= 0 AND usr.kind = 'multicast' AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE usr.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE usr.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE usr.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END)",
          "refId": "A"
        }
      ],
      "title": "Multicast Users Throughput",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": 0
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 0,
        "y": 6
      },
      "id": 5,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT COUNT(DISTINCT u.pk) as value FROM dz_users_current u JOIN solana_gossip_nodes_current gn ON u.dz_ip = gn.gossip_ip JOIN solana_vote_accounts_current va ON gn.pubkey = va.node_pubkey LEFT JOIN dz_devices_current d ON u.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE va.epoch_vote_account = true AND va.activated_stake_lamports > 0 AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE u.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END)",
          "refId": "A"
        }
      ],
      "title": "Solana Validators on DZ",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": 0
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 3,
        "y": 6
      },
      "id": 6,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT COUNT(DISTINCT u.pk) as value FROM dz_users_current u JOIN solana_gossip_nodes_current gn ON u.dz_ip = gn.gossip_ip LEFT JOIN solana_vote_accounts_current va ON gn.pubkey = va.node_pubkey LEFT JOIN dz_devices_current d ON u.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE (va.vote_pubkey IS NULL OR va.epoch_vote_account = false OR va.activated_stake_lamports = 0) AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE u.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END)",
          "refId": "A"
        }
      ],
      "title": "Solana Gossip-Only Nodes on DZ",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": 0
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 6,
        "y": 6
      },
      "id": 12,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT CAST(COALESCE(SUM(dz_stake.activated_stake_lamports), 0) * 100.0 / NULLIF(SUM(all_stake.activated_stake_lamports), 0) AS DOUBLE) as value FROM (SELECT SUM(va.activated_stake_lamports) as activated_stake_lamports FROM dz_users_current u JOIN solana_gossip_nodes_current gn ON u.dz_ip = gn.gossip_ip JOIN solana_vote_accounts_current va ON gn.pubkey = va.node_pubkey LEFT JOIN dz_devices_current d ON u.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE va.epoch_vote_account = true AND va.activated_stake_lamports > 0 AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE u.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END)) dz_stake CROSS JOIN (SELECT SUM(activated_stake_lamports) as activated_stake_lamports FROM solana_vote_accounts_current WHERE epoch_vote_account = true AND activated_stake_lamports > 0) all_stake",
          "refId": "A"
        }
      ],
      "title": "Total Solana Stake %",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": 0
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 9,
        "y": 6
      },
      "id": 13,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT CAST(COUNT(DISTINCT dz_validators.node_pubkey) * 100.0 / NULLIF(COUNT(DISTINCT all_validators.node_pubkey), 0) AS DOUBLE) as value FROM (SELECT DISTINCT va.node_pubkey FROM dz_users_current u JOIN solana_gossip_nodes_current gn ON u.dz_ip = gn.gossip_ip JOIN solana_vote_accounts_current va ON gn.pubkey = va.node_pubkey LEFT JOIN dz_devices_current d ON u.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE va.epoch_vote_account = true AND va.activated_stake_lamports > 0 AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE u.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END)) dz_validators CROSS JOIN (SELECT DISTINCT node_pubkey FROM solana_vote_accounts_current WHERE epoch_vote_account = true AND activated_stake_lamports > 0) all_validators",
          "refId": "A"
        }
      ],
      "title": "% of Solana Validators on DZ",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": 0
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Peak"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Peak"
              },
              {
                "id": "unit",
                "value": "bps"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Avg"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Avg"
              },
              {
                "id": "unit",
                "value": "bps"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 12,
        "y": 6
      },
      "id": 9,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": true
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT CAST(COALESCE(AVG((u.in_octets_delta + u.out_octets_delta) * 8.0 / NULLIF(u.delta_duration, 0)), 0) AS DOUBLE) as \"Avg\", CAST(COALESCE(MAX((u.in_octets_delta + u.out_octets_delta) * 8.0 / NULLIF(u.delta_duration, 0)), 0) AS DOUBLE) as \"Peak\" FROM dz_device_interface_counters_raw u JOIN dz_users_current usr ON u.device_pk = usr.device_pk AND u.user_tunnel_id = usr.tunnel_id JOIN solana_gossip_nodes_current gn ON usr.dz_ip = gn.gossip_ip JOIN solana_vote_accounts_current va ON gn.pubkey = va.node_pubkey LEFT JOIN dz_devices_current d ON usr.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE u.time >= $__timeFrom() AND u.time <= $__timeTo() AND u.delta_duration > 0 AND u.in_octets_delta >= 0 AND u.out_octets_delta >= 0 AND va.epoch_vote_account = true AND va.activated_stake_lamports > 0 AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE usr.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE usr.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE usr.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END)",
          "refId": "A"
        }
      ],
      "title": "Solana Validators Throughput",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": 0
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Peak"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Peak"
              },
              {
                "id": "unit",
                "value": "bps"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Avg"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Avg"
              },
              {
                "id": "unit",
                "value": "bps"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 18,
        "y": 6
      },
      "id": 10,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": true
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT CAST(COALESCE(AVG((u.in_octets_delta + u.out_octets_delta) * 8.0 / NULLIF(u.delta_duration, 0)), 0) AS DOUBLE) as \"Avg\", CAST(COALESCE(MAX((u.in_octets_delta + u.out_octets_delta) * 8.0 / NULLIF(u.delta_duration, 0)), 0) AS DOUBLE) as \"Peak\" FROM dz_device_interface_counters_raw u JOIN dz_users_current usr ON u.device_pk = usr.device_pk AND u.user_tunnel_id = usr.tunnel_id JOIN solana_gossip_nodes_current gn ON usr.dz_ip = gn.gossip_ip LEFT JOIN solana_vote_accounts_current va ON gn.pubkey = va.node_pubkey LEFT JOIN dz_devices_current d ON usr.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE u.time >= $__timeFrom() AND u.time <= $__timeTo() AND u.delta_duration > 0 AND u.in_octets_delta >= 0 AND u.out_octets_delta >= 0 AND (va.vote_pubkey IS NULL OR va.epoch_vote_account = false OR va.activated_stake_lamports = 0) AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE usr.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE usr.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE usr.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END)",
          "refId": "A"
        }
      ],
      "title": "Solana Gossip-Only Throughput",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "User Type"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": true,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 10
      },
      "id": 17,
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "WITH time_series AS (SELECT date_trunc('hour', generate_series) as time FROM generate_series(CAST($__timeFrom() AS TIMESTAMP), CAST($__timeTo() AS TIMESTAMP) + INTERVAL '1 hour', INTERVAL '1 hour')), user_changes AS (SELECT u.pk, u.kind, u.status, u.valid_from, COALESCE(u.valid_to, CAST('9999-12-31' AS TIMESTAMP)) as valid_to FROM dz_users_history u WHERE u.op != 'D' AND (u.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (u.valid_to IS NULL OR u.valid_to >= CAST($__timeFrom() AS TIMESTAMP))) AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END)), active_users AS (SELECT ts.time, uc.kind, COUNT(DISTINCT CASE WHEN uc.valid_from <= ts.time AND uc.valid_to > ts.time AND uc.status = 'activated' THEN uc.pk END) as user_count FROM time_series ts CROSS JOIN user_changes uc GROUP BY ts.time, uc.kind) SELECT time, COALESCE(kind, 'unknown') as \"User Type\", CAST(user_count AS DOUBLE) as \"User Count\" FROM active_users ORDER BY time, \"User Type\"",
          "refId": "A"
        }
      ],
      "title": "DoubleZero User Count Over Time",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "User Type"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": true,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 10
      },
      "id": 102,
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "WITH time_series AS (SELECT date_trunc('hour', generate_series) as time FROM generate_series(CAST($__timeFrom() AS TIMESTAMP), CAST($__timeTo() AS TIMESTAMP) + INTERVAL '1 hour', INTERVAL '1 hour')), validator_users AS (SELECT DISTINCT u.pk, u.kind, u.status, u.dz_ip, u.valid_from, COALESCE(u.valid_to, CAST('9999-12-31' AS TIMESTAMP)) as valid_to FROM dz_users_history u JOIN solana_gossip_nodes_history gn ON u.dz_ip = gn.gossip_ip AND gn.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (gn.valid_to IS NULL OR gn.valid_to >= CAST($__timeFrom() AS TIMESTAMP)) JOIN solana_vote_accounts_history va ON gn.pubkey = va.node_pubkey WHERE u.op != 'D' AND (u.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (u.valid_to IS NULL OR u.valid_to >= CAST($__timeFrom() AS TIMESTAMP))) AND va.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (va.valid_to IS NULL OR va.valid_to >= CAST($__timeFrom() AS TIMESTAMP)) AND va.epoch_vote_account = true AND va.activated_stake_lamports > 0 AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END)), active_validators AS (SELECT ts.time, vu.kind, COUNT(DISTINCT CASE WHEN vu.valid_from <= ts.time AND vu.valid_to > ts.time AND vu.status = 'activated' AND EXISTS (SELECT 1 FROM solana_gossip_nodes_history gn2 JOIN solana_vote_accounts_history va2 ON gn2.pubkey = va2.node_pubkey WHERE gn2.gossip_ip = vu.dz_ip AND gn2.valid_from <= ts.time AND (gn2.valid_to IS NULL OR gn2.valid_to > ts.time) AND va2.valid_from <= ts.time AND (va2.valid_to IS NULL OR va2.valid_to > ts.time) AND va2.epoch_vote_account = true AND va2.activated_stake_lamports > 0) THEN vu.pk END) as validator_count FROM time_series ts CROSS JOIN validator_users vu GROUP BY ts.time, vu.kind) SELECT time, COALESCE(kind, 'unknown') as \"User Type\", CAST(validator_count AS DOUBLE) as \"Validator Count\" FROM active_validators ORDER BY time, \"User Type\"",
          "refId": "A"
        }
      ],
      "title": "Solana Validators on DZ Over Time",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "User Type"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": true,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 10
      },
      "id": 19,
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "WITH time_series AS (SELECT date_trunc('hour', generate_series) as time FROM generate_series(CAST($__timeFrom() AS TIMESTAMP), CAST($__timeTo() AS TIMESTAMP) + INTERVAL '1 hour', INTERVAL '1 hour')), validator_nodes_at_time AS (SELECT ts.time, va.node_pubkey FROM time_series ts CROSS JOIN solana_vote_accounts_history va WHERE va.valid_from <= ts.time AND (va.valid_to IS NULL OR va.valid_to > ts.time) AND va.epoch_vote_account = true AND va.activated_stake_lamports > 0), gossip_only_users AS (SELECT DISTINCT u.pk, u.kind, u.status, u.dz_ip, u.valid_from, COALESCE(u.valid_to, CAST('9999-12-31' AS TIMESTAMP)) as valid_to FROM dz_users_history u JOIN solana_gossip_nodes_history gn ON u.dz_ip = gn.gossip_ip WHERE u.op != 'D' AND (u.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (u.valid_to IS NULL OR u.valid_to >= CAST($__timeFrom() AS TIMESTAMP))) AND gn.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (gn.valid_to IS NULL OR gn.valid_to >= CAST($__timeFrom() AS TIMESTAMP)) AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END)), active_gossip_only AS (SELECT ts.time, gou.kind, COUNT(DISTINCT CASE WHEN gou.valid_from <= ts.time AND gou.valid_to > ts.time AND gou.status = 'activated' AND EXISTS (SELECT 1 FROM solana_gossip_nodes_history gn2 WHERE gn2.gossip_ip = gou.dz_ip AND gn2.valid_from <= ts.time AND (gn2.valid_to IS NULL OR gn2.valid_to > ts.time) AND NOT EXISTS (SELECT 1 FROM validator_nodes_at_time vnat WHERE vnat.time = ts.time AND vnat.node_pubkey = gn2.pubkey)) THEN gou.pk END) as gossip_only_count FROM time_series ts CROSS JOIN gossip_only_users gou GROUP BY ts.time, gou.kind) SELECT time, COALESCE(kind, 'unknown') as \"User Type\", CAST(gossip_only_count AS DOUBLE) as \"Gossip-Only Count\" FROM active_gossip_only ORDER BY time, \"User Type\"",
          "refId": "A"
        }
      ],
      "title": "Solana Gossip-Only Nodes on DZ Over Time",
      "type": "timeseries"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 18
      },
      "id": 100,
      "panels": [
        {
          "fieldConfig": {
            "defaults": {
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 19
          },
          "id": 27,
          "options": {
            "cellHeight": "sm",
            "enablePagination": true,
            "showHeader": true,
            "sortBy": [
              {
                "desc": true,
                "displayName": "Connect Time"
              }
            ]
          },
          "pluginVersion": "12.3.1",
          "targets": [
            {
              "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "WITH newly_connected_users AS (SELECT u.pk, u.owner_pubkey, u.client_ip, u.dz_ip, u.device_pk, u.tunnel_id, u.kind, u.status, u.valid_from as connect_time FROM dz_users_history u WHERE u.op = 'I' AND u.valid_from >= CAST($__timeFrom() AS TIMESTAMP) AND u.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (u.dz_ip NOT IN (SELECT DISTINCT gn.gossip_ip FROM solana_gossip_nodes_current gn) OR u.dz_ip IS NULL) AND EXISTS (SELECT 1 FROM dz_users_current uc WHERE uc.pk = u.pk)), unique_newly_connected AS (SELECT ncu.pk, MAX(ncu.owner_pubkey) as owner_pubkey, MAX(ncu.client_ip) as client_ip, MAX(ncu.dz_ip) as dz_ip, MAX(ncu.device_pk) as device_pk, MAX(ncu.tunnel_id) as tunnel_id, MAX(ncu.kind) as kind, MAX(ncu.status) as status, MIN(ncu.connect_time) as connect_time FROM newly_connected_users ncu GROUP BY ncu.pk) SELECT DISTINCT ncu.pk as \"DZ User PK\", ncu.owner_pubkey as \"Owner PK\", ncu.kind as \"Kind\", ncu.client_ip as \"Client IP\", ncu.dz_ip as \"DZ IP\", ncu.connect_time as \"Connect Time\", CAST(ABS(EXTRACT(EPOCH FROM (NOW() - ncu.connect_time))) / 86400.0 AS DOUBLE) as \"Age (days)\", d.code as \"Device\", m.code as \"Metro\", c.code as \"Contributor\", ncu.tunnel_id as \"Tunnel ID\", COALESCE(throughput.avg_in_throughput, 0) as \"Avg In Throughput (bps)\", COALESCE(throughput.peak_in_throughput, 0) as \"Peak In Throughput (bps)\", COALESCE(throughput.avg_out_throughput, 0) as \"Avg Out Throughput (bps)\", COALESCE(throughput.peak_out_throughput, 0) as \"Peak Out Throughput (bps)\" FROM unique_newly_connected ncu LEFT JOIN dz_devices_current d ON ncu.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk LEFT JOIN (SELECT usr.pk, AVG(u.in_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as avg_in_throughput, MAX(u.in_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as peak_in_throughput, AVG(u.out_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as avg_out_throughput, MAX(u.out_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as peak_out_throughput FROM dz_device_interface_counters_raw u JOIN dz_users_current usr ON u.device_pk = usr.device_pk AND u.user_tunnel_id = usr.tunnel_id WHERE u.time >= $__timeFrom() AND u.time <= $__timeTo() AND u.delta_duration > 0 AND u.in_octets_delta >= 0 AND u.out_octets_delta >= 0 GROUP BY usr.pk) throughput ON throughput.pk = ncu.pk WHERE (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE ncu.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE ncu.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE ncu.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END) ORDER BY ncu.connect_time DESC, ncu.pk",
              "refId": "A"
            }
          ],
          "title": "Newly Connected Users (Time Range)",
          "type": "table"
        },
        {
          "fieldConfig": {
            "defaults": {
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 27
          },
          "id": 29,
          "options": {
            "cellHeight": "sm",
            "enablePagination": true,
            "showHeader": true,
            "sortBy": [
              {
                "desc": true,
                "displayName": "Stake %"
              }
            ]
          },
          "pluginVersion": "12.3.1",
          "targets": [
            {
              "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "WITH dz_removed_users AS (SELECT du.pk AS dz_user_pk, du.owner_pubkey, du.client_ip, du.dz_ip, du.valid_from AS removal_time FROM dz_users_history du WHERE du.op = 'D' AND du.valid_from >= CAST($__timeFrom() AS TIMESTAMP) AND du.valid_from <= CAST($__timeTo() AS TIMESTAMP)), solana_nodes_recent AS (SELECT DISTINCT sgn.pubkey, sgn.gossip_ip FROM solana_gossip_nodes_history sgn WHERE sgn.valid_from >= CAST($__timeFrom() AS TIMESTAMP) AND sgn.valid_from <= CAST($__timeTo() AS TIMESTAMP)), matched AS (SELECT DISTINCT dru.dz_user_pk, dru.owner_pubkey, dru.client_ip, dru.dz_ip, snr.pubkey AS solana_node_pubkey, dru.removal_time FROM dz_removed_users dru INNER JOIN solana_nodes_recent snr ON dru.client_ip = snr.gossip_ip), ips_readded_after_removal AS (SELECT DISTINCT m.client_ip FROM matched m WHERE EXISTS (SELECT 1 FROM dz_users_history duh WHERE duh.client_ip = m.client_ip AND duh.op IN ('I', 'U') AND duh.valid_from > m.removal_time)), not_rejoined AS (SELECT m.solana_node_pubkey, m.dz_user_pk, m.owner_pubkey, m.client_ip, m.dz_ip, m.removal_time, sva.activated_stake_lamports, sva.vote_pubkey FROM matched m LEFT JOIN solana_vote_accounts_current sva ON m.solana_node_pubkey = sva.node_pubkey LEFT JOIN ips_readded_after_removal rar ON m.client_ip = rar.client_ip WHERE rar.client_ip IS NULL AND sva.node_pubkey IS NOT NULL AND sva.epoch_vote_account = true AND sva.activated_stake_lamports > 0), total_stake AS (SELECT SUM(CAST(activated_stake_lamports AS BIGINT)) as total_activated_stake FROM solana_vote_accounts_current WHERE activated_stake_lamports > 0) SELECT nr.dz_user_pk as \"DZ User PK\", nr.dz_ip as \"DZ IP\", nr.client_ip as \"Client IP\", nr.solana_node_pubkey as \"Node Pubkey\", nr.vote_pubkey as \"Vote Account Pubkey\", CASE WHEN nr.activated_stake_lamports IS NOT NULL THEN CAST(nr.activated_stake_lamports / 1000000000.0 AS DOUBLE) ELSE NULL END as \"Stake (SOL)\", CASE WHEN nr.activated_stake_lamports IS NOT NULL AND ts.total_activated_stake > 0 THEN CAST(100.0 * CAST(nr.activated_stake_lamports AS DOUBLE) / CAST(ts.total_activated_stake AS DOUBLE) AS DOUBLE) ELSE NULL END as \"Stake %\", nr.removal_time as \"Disconnect Time\" FROM not_rejoined nr CROSS JOIN total_stake ts ORDER BY nr.activated_stake_lamports DESC, nr.removal_time DESC",
              "refId": "A"
            }
          ],
          "title": "Disconnected Solana Validators",
          "type": "table"
        },
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Avg In Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Peak In Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Avg Out Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Peak Out Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 35
          },
          "id": 28,
          "options": {
            "cellHeight": "sm",
            "enablePagination": true,
            "showHeader": true,
            "sortBy": [
              {
                "desc": true,
                "displayName": "Stake %"
              }
            ]
          },
          "pluginVersion": "12.3.1",
          "targets": [
            {
              "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "WITH total_stake AS (SELECT SUM(CAST(activated_stake_lamports AS BIGINT)) as total_activated_stake FROM solana_vote_accounts_current WHERE activated_stake_lamports > 0), primary_vote_accounts AS (SELECT node_pubkey, vote_pubkey, activated_stake_lamports FROM (SELECT node_pubkey, vote_pubkey, activated_stake_lamports, ROW_NUMBER() OVER (PARTITION BY node_pubkey ORDER BY activated_stake_lamports DESC) as rn FROM solana_vote_accounts_current WHERE epoch_vote_account = true AND activated_stake_lamports > 0) ranked WHERE rn = 1), newly_connected_users AS (SELECT u.pk, u.owner_pubkey, u.client_ip, u.dz_ip, u.device_pk, u.tunnel_id, u.kind, u.status, u.valid_from as connect_time FROM dz_users_history u WHERE u.op = 'I' AND u.valid_from >= CAST($__timeFrom() AS TIMESTAMP) AND u.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND u.status = 'activated'), unique_newly_connected AS (SELECT ncu.pk, MAX(ncu.owner_pubkey) as owner_pubkey, MAX(ncu.client_ip) as client_ip, MAX(ncu.dz_ip) as dz_ip, MAX(ncu.device_pk) as device_pk, MAX(ncu.tunnel_id) as tunnel_id, MAX(ncu.kind) as kind, MAX(ncu.status) as status, MIN(ncu.connect_time) as connect_time FROM newly_connected_users ncu GROUP BY ncu.pk), user_gossip_nodes AS (SELECT DISTINCT ncu.pk, gn.pubkey FROM unique_newly_connected ncu JOIN solana_gossip_nodes_current gn ON ncu.dz_ip = gn.gossip_ip JOIN primary_vote_accounts pva ON gn.pubkey = pva.node_pubkey) SELECT DISTINCT pva.vote_pubkey as \"Vote Account Pubkey\", ugn.pubkey as \"Validator Pubkey\", ncu.client_ip as \"Client IP\", ncu.connect_time as \"Connect Time\", CAST(ABS(EXTRACT(EPOCH FROM (NOW() - ncu.connect_time))) / 86400.0 AS DOUBLE) as \"Age (days)\", d.code as \"Device\", m.code as \"Metro\", c.code as \"Contributor\", COALESCE(throughput.avg_in_throughput, 0) as \"Avg In Throughput (bps)\", COALESCE(throughput.peak_in_throughput, 0) as \"Peak In Throughput (bps)\", COALESCE(throughput.avg_out_throughput, 0) as \"Avg Out Throughput (bps)\", COALESCE(throughput.peak_out_throughput, 0) as \"Peak Out Throughput (bps)\", CASE WHEN pva.activated_stake_lamports IS NOT NULL THEN CAST(pva.activated_stake_lamports / 1000000000.0 AS DOUBLE) ELSE NULL END as \"Stake (SOL)\", CASE WHEN pva.activated_stake_lamports IS NOT NULL AND ts.total_activated_stake > 0 THEN CAST(100.0 * CAST(pva.activated_stake_lamports AS DOUBLE) / CAST(ts.total_activated_stake AS DOUBLE) AS DOUBLE) ELSE NULL END as \"Stake %\", ncu.pk as \"DZ User PK\", ncu.dz_ip as \"DZ IP\", ncu.tunnel_id as \"Tunnel ID\", CASE WHEN gn.tpuquic_ip IS NOT NULL AND gn.tpuquic_port IS NOT NULL AND gn.tpuquic_port > 0 THEN gn.tpuquic_ip || ':' || CAST(gn.tpuquic_port AS VARCHAR) ELSE NULL END as \"TPU-QUIC Address\" FROM unique_newly_connected ncu JOIN user_gossip_nodes ugn ON ncu.pk = ugn.pk JOIN solana_gossip_nodes_current gn ON ugn.pubkey = gn.pubkey JOIN primary_vote_accounts pva ON gn.pubkey = pva.node_pubkey LEFT JOIN dz_devices_current d ON ncu.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk LEFT JOIN (SELECT usr.pk, AVG(u.in_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as avg_in_throughput, MAX(u.in_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as peak_in_throughput, AVG(u.out_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as avg_out_throughput, MAX(u.out_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as peak_out_throughput FROM dz_device_interface_counters_raw u JOIN dz_users_current usr ON u.device_pk = usr.device_pk AND u.user_tunnel_id = usr.tunnel_id WHERE u.time >= $__timeFrom() AND u.time <= $__timeTo() AND u.delta_duration > 0 AND u.in_octets_delta >= 0 AND u.out_octets_delta >= 0 GROUP BY usr.pk) throughput ON throughput.pk = ncu.pk CROSS JOIN total_stake ts WHERE (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE ncu.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE ncu.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE ncu.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END) ORDER BY CASE WHEN pva.activated_stake_lamports IS NOT NULL AND ts.total_activated_stake > 0 THEN CAST(100.0 * CAST(pva.activated_stake_lamports AS DOUBLE) / CAST(ts.total_activated_stake AS DOUBLE) AS DOUBLE) ELSE 0 END DESC, ncu.connect_time DESC",
              "refId": "A"
            }
          ],
          "title": "Newly Connected Solana Validators (Time Range)",
          "type": "table"
        },
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Avg In Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Peak In Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Avg Out Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Peak Out Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 43
          },
          "id": 26,
          "options": {
            "cellHeight": "sm",
            "enablePagination": true,
            "showHeader": true,
            "sortBy": []
          },
          "pluginVersion": "12.3.1",
          "targets": [
            {
              "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "WITH validator_nodes AS (SELECT DISTINCT node_pubkey FROM solana_vote_accounts_current WHERE epoch_vote_account = true AND activated_stake_lamports > 0), newly_connected_users AS (SELECT u.pk, u.owner_pubkey, u.client_ip, u.dz_ip, u.device_pk, u.tunnel_id, u.kind, u.status, u.valid_from as connect_time FROM dz_users_history u WHERE u.op = 'I' AND u.valid_from >= CAST($__timeFrom() AS TIMESTAMP) AND u.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND u.status = 'activated'), unique_newly_connected AS (SELECT ncu.pk, MAX(ncu.owner_pubkey) as owner_pubkey, MAX(ncu.client_ip) as client_ip, MAX(ncu.dz_ip) as dz_ip, MAX(ncu.device_pk) as device_pk, MAX(ncu.tunnel_id) as tunnel_id, MAX(ncu.kind) as kind, MAX(ncu.status) as status, MIN(ncu.connect_time) as connect_time FROM newly_connected_users ncu GROUP BY ncu.pk), user_gossip_nodes AS (SELECT DISTINCT ncu.pk, gn.pubkey FROM unique_newly_connected ncu JOIN solana_gossip_nodes_current gn ON ncu.dz_ip = gn.gossip_ip LEFT JOIN validator_nodes vn ON gn.pubkey = vn.node_pubkey WHERE vn.node_pubkey IS NULL) SELECT DISTINCT ncu.pk as \"DZ User PK\", ncu.client_ip as \"Client IP\", ncu.dz_ip as \"DZ IP\", ugn.pubkey as \"Node Pubkey\", NULL as \"Vote Account Pubkey\", d.code as \"Device\", m.code as \"Metro\", c.code as \"Contributor\", ncu.tunnel_id as \"Tunnel ID\", ncu.connect_time as \"Connect Time\", CASE WHEN gn.tpuquic_ip IS NOT NULL AND gn.tpuquic_port IS NOT NULL AND gn.tpuquic_port > 0 THEN gn.tpuquic_ip || ':' || CAST(gn.tpuquic_port AS VARCHAR) ELSE NULL END as \"TPU-QUIC Address\", COALESCE(throughput.avg_in_throughput, 0) as \"Avg In Throughput (bps)\", COALESCE(throughput.peak_in_throughput, 0) as \"Peak In Throughput (bps)\", COALESCE(throughput.avg_out_throughput, 0) as \"Avg Out Throughput (bps)\", COALESCE(throughput.peak_out_throughput, 0) as \"Peak Out Throughput (bps)\" FROM unique_newly_connected ncu JOIN user_gossip_nodes ugn ON ncu.pk = ugn.pk JOIN solana_gossip_nodes_current gn ON ugn.pubkey = gn.pubkey LEFT JOIN dz_devices_current d ON ncu.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk LEFT JOIN (SELECT usr.pk, AVG(u.in_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as avg_in_throughput, MAX(u.in_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as peak_in_throughput, AVG(u.out_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as avg_out_throughput, MAX(u.out_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as peak_out_throughput FROM dz_device_interface_counters_raw u JOIN dz_users_current usr ON u.device_pk = usr.device_pk AND u.user_tunnel_id = usr.tunnel_id WHERE u.time >= $__timeFrom() AND u.time <= $__timeTo() AND u.delta_duration > 0 AND u.in_octets_delta >= 0 AND u.out_octets_delta >= 0 GROUP BY usr.pk) throughput ON throughput.pk = ncu.pk WHERE (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE ncu.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE ncu.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE ncu.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END) ORDER BY ncu.connect_time DESC, ncu.pk",
              "refId": "A"
            }
          ],
          "title": "Newly Connected Solana Gossip-Only Nodes (Time Range)",
          "type": "table"
        }
      ],
      "title": "Newly Connected/Disconnected Tables",
      "type": "row"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 19
      },
      "id": 32,
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "WITH time_series AS (SELECT date_trunc('hour', generate_series) as time FROM generate_series(CAST($__timeFrom() AS TIMESTAMP), CAST($__timeTo() AS TIMESTAMP) + INTERVAL '1 hour', INTERVAL '1 hour')), validator_nodes_at_time AS (SELECT ts.time, va.node_pubkey FROM time_series ts CROSS JOIN solana_vote_accounts_history va WHERE va.valid_from <= ts.time AND (va.valid_to IS NULL OR va.valid_to > ts.time) AND va.epoch_vote_account = true AND va.activated_stake_lamports > 0), all_solana_users AS (SELECT DISTINCT u.pk, u.kind, u.status, u.dz_ip, u.valid_from, COALESCE(u.valid_to, CAST('9999-12-31' AS TIMESTAMP)) as valid_to FROM dz_users_history u JOIN solana_gossip_nodes_history gn ON u.dz_ip = gn.gossip_ip WHERE u.op != 'D' AND (u.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (u.valid_to IS NULL OR u.valid_to >= CAST($__timeFrom() AS TIMESTAMP))) AND gn.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (gn.valid_to IS NULL OR gn.valid_to >= CAST($__timeFrom() AS TIMESTAMP)) AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END)), node_counts AS (SELECT ts.time, COUNT(DISTINCT CASE WHEN asu.valid_from <= ts.time AND asu.valid_to > ts.time AND asu.status = 'activated' AND EXISTS (SELECT 1 FROM solana_gossip_nodes_history gn2 JOIN solana_vote_accounts_history va2 ON gn2.pubkey = va2.node_pubkey WHERE gn2.gossip_ip = asu.dz_ip AND gn2.valid_from <= ts.time AND (gn2.valid_to IS NULL OR gn2.valid_to > ts.time) AND va2.valid_from <= ts.time AND (va2.valid_to IS NULL OR va2.valid_to > ts.time) AND va2.epoch_vote_account = true AND va2.activated_stake_lamports > 0) THEN asu.pk END) as validator_count, COUNT(DISTINCT CASE WHEN asu.valid_from <= ts.time AND asu.valid_to > ts.time AND asu.status = 'activated' AND EXISTS (SELECT 1 FROM solana_gossip_nodes_history gn2 WHERE gn2.gossip_ip = asu.dz_ip AND gn2.valid_from <= ts.time AND (gn2.valid_to IS NULL OR gn2.valid_to > ts.time) AND NOT EXISTS (SELECT 1 FROM validator_nodes_at_time vnat WHERE vnat.time = ts.time AND vnat.node_pubkey = gn2.pubkey)) THEN asu.pk END) as gossip_only_count FROM time_series ts CROSS JOIN all_solana_users asu GROUP BY ts.time) SELECT time, CAST(validator_count AS DOUBLE) as \"Validators\", CAST(gossip_only_count AS DOUBLE) as \"Gossip-Only Nodes\" FROM node_counts ORDER BY time",
          "refId": "A"
        }
      ],
      "title": "Solana Nodes on DZ Over Time",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 19
      },
      "id": 30,
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "WITH time_series AS (SELECT date_trunc('hour', generate_series) as time FROM generate_series(CAST($__timeFrom() AS TIMESTAMP), CAST($__timeTo() AS TIMESTAMP) + INTERVAL '1 hour', INTERVAL '1 hour')), dz_validators_at_time AS (SELECT ts.time, SUM(CAST(va.activated_stake_lamports AS BIGINT)) as dz_stake_lamports FROM time_series ts CROSS JOIN dz_users_history u JOIN solana_gossip_nodes_history gn ON u.dz_ip = gn.gossip_ip AND gn.valid_from <= ts.time AND (gn.valid_to IS NULL OR gn.valid_to > ts.time) JOIN solana_vote_accounts_history va ON gn.pubkey = va.node_pubkey WHERE u.op != 'D' AND (u.valid_from <= ts.time AND (u.valid_to IS NULL OR u.valid_to > ts.time)) AND u.status = 'activated' AND va.valid_from <= ts.time AND (va.valid_to IS NULL OR va.valid_to > ts.time) AND va.epoch_vote_account = true AND va.activated_stake_lamports > 0 AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) GROUP BY ts.time), total_stake_at_time AS (SELECT ts.time, SUM(CAST(va.activated_stake_lamports AS BIGINT)) as total_stake_lamports FROM time_series ts CROSS JOIN solana_vote_accounts_history va WHERE va.valid_from <= ts.time AND (va.valid_to IS NULL OR va.valid_to > ts.time) AND va.epoch_vote_account = true AND va.activated_stake_lamports > 0 GROUP BY ts.time) SELECT dz.time, CAST(100.0 * CAST(COALESCE(dz.dz_stake_lamports, 0) AS DOUBLE) / NULLIF(CAST(COALESCE(ts.total_stake_lamports, 0) AS DOUBLE), 0) AS DOUBLE) as \"Stake %\" FROM dz_validators_at_time dz LEFT JOIN total_stake_at_time ts ON dz.time = ts.time WHERE ts.total_stake_lamports > 0 ORDER BY dz.time",
          "refId": "A"
        }
      ],
      "title": "Solana Stake % on DZ Over Time",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 19
      },
      "id": 31,
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "WITH time_series AS (SELECT date_trunc('hour', generate_series) as time FROM generate_series(CAST($__timeFrom() AS TIMESTAMP), CAST($__timeTo() AS TIMESTAMP) + INTERVAL '1 hour', INTERVAL '1 hour')), dz_validators_at_time AS (SELECT ts.time, SUM(CAST(va.activated_stake_lamports AS BIGINT)) as dz_stake_lamports FROM time_series ts CROSS JOIN dz_users_history u JOIN solana_gossip_nodes_history gn ON u.dz_ip = gn.gossip_ip AND gn.valid_from <= ts.time AND (gn.valid_to IS NULL OR gn.valid_to > ts.time) JOIN solana_vote_accounts_history va ON gn.pubkey = va.node_pubkey WHERE u.op != 'D' AND (u.valid_from <= ts.time AND (u.valid_to IS NULL OR u.valid_to > ts.time)) AND u.status = 'activated' AND va.valid_from <= ts.time AND (va.valid_to IS NULL OR va.valid_to > ts.time) AND va.epoch_vote_account = true AND va.activated_stake_lamports > 0 AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) GROUP BY ts.time) SELECT time, CAST(COALESCE(dz_stake_lamports, 0) / 1000000000.0 AS DOUBLE) as \"Stake (SOL)\" FROM dz_validators_at_time WHERE dz_stake_lamports > 0 ORDER BY time",
          "refId": "A"
        }
      ],
      "title": "Solana Stake on DZ Over Time",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "bps"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "User Type"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": true,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 27
      },
      "id": 23,
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "SELECT date_trunc('minute', u.time) as time, COALESCE(usr.kind, 'unknown') as \"User Type\", CAST(SUM(u.in_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) AS DOUBLE) as \"In Throughput (bps)\", CAST(SUM(u.out_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) AS DOUBLE) as \"Out Throughput (bps)\" FROM dz_device_interface_counters_raw u JOIN dz_users_current usr ON u.device_pk = usr.device_pk AND u.user_tunnel_id = usr.tunnel_id LEFT JOIN dz_devices_current d ON usr.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE u.time >= CAST($__timeFrom() AS TIMESTAMP) AND u.time <= CAST($__timeTo() AS TIMESTAMP) AND u.delta_duration > 0 AND u.in_octets_delta >= 0 AND u.out_octets_delta >= 0 AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE usr.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE usr.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE usr.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END) GROUP BY date_trunc('minute', u.time), usr.kind ORDER BY time, \"User Type\"",
          "refId": "A"
        }
      ],
      "title": "DoubleZero User Throughput Over Time",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "bps"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "User Type"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": true,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 27
      },
      "id": 24,
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "SELECT date_trunc('minute', u.time) as time, COALESCE(usr.kind, 'unknown') as \"User Type\", CAST(SUM(u.in_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) AS DOUBLE) as \"In Throughput (bps)\", CAST(SUM(u.out_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) AS DOUBLE) as \"Out Throughput (bps)\" FROM dz_device_interface_counters_raw u JOIN dz_users_current usr ON u.device_pk = usr.device_pk AND u.user_tunnel_id = usr.tunnel_id JOIN solana_gossip_nodes_current gn ON usr.dz_ip = gn.gossip_ip JOIN solana_vote_accounts_current va ON gn.pubkey = va.node_pubkey LEFT JOIN dz_devices_current d ON usr.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE u.time >= CAST($__timeFrom() AS TIMESTAMP) AND u.time <= CAST($__timeTo() AS TIMESTAMP) AND u.delta_duration > 0 AND u.in_octets_delta >= 0 AND u.out_octets_delta >= 0 AND va.epoch_vote_account = true AND va.activated_stake_lamports > 0 AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE usr.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE usr.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE usr.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END) GROUP BY date_trunc('minute', u.time), usr.kind ORDER BY time, \"User Type\"",
          "refId": "A"
        }
      ],
      "title": "Solana Validators Throughput Over Time",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "bps"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "User Type"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": true,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 27
      },
      "id": 25,
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "SELECT date_trunc('minute', u.time) as time, COALESCE(usr.kind, 'unknown') as \"User Type\", CAST(SUM(u.in_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) AS DOUBLE) as \"In Throughput (bps)\", CAST(SUM(u.out_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) AS DOUBLE) as \"Out Throughput (bps)\" FROM dz_device_interface_counters_raw u JOIN dz_users_current usr ON u.device_pk = usr.device_pk AND u.user_tunnel_id = usr.tunnel_id JOIN solana_gossip_nodes_current gn ON usr.dz_ip = gn.gossip_ip LEFT JOIN dz_devices_current d ON usr.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE u.time >= CAST($__timeFrom() AS TIMESTAMP) AND u.time <= CAST($__timeTo() AS TIMESTAMP) AND u.delta_duration > 0 AND u.in_octets_delta >= 0 AND u.out_octets_delta >= 0 AND gn.pubkey NOT IN (SELECT node_pubkey FROM solana_vote_accounts_current WHERE epoch_vote_account = true AND activated_stake_lamports > 0) AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE usr.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE usr.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE usr.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END) GROUP BY date_trunc('minute', u.time), usr.kind ORDER BY time, \"User Type\"",
          "refId": "A"
        }
      ],
      "title": "Solana Gossip-Only Nodes Throughput Over Time",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Device"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": true,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 35
      },
      "id": 20,
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "WITH time_series AS (SELECT date_trunc('hour', generate_series) as time FROM generate_series(CAST($__timeFrom() AS TIMESTAMP), CAST($__timeTo() AS TIMESTAMP) + INTERVAL '1 hour', INTERVAL '1 hour')), user_changes AS (SELECT u.pk, u.kind, u.status, u.device_pk, u.owner_pubkey, u.valid_from, COALESCE(u.valid_to, CAST('9999-12-31' AS TIMESTAMP)) as valid_to FROM dz_users_history u WHERE u.op != 'D' AND (u.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (u.valid_to IS NULL OR u.valid_to >= CAST($__timeFrom() AS TIMESTAMP))) AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE u.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END)), active_users AS (SELECT ts.time, COALESCE(d.code, 'unknown') as device, COUNT(DISTINCT CASE WHEN uc.valid_from <= ts.time AND uc.valid_to > ts.time AND uc.status = 'activated' THEN uc.pk END) as user_count FROM time_series ts CROSS JOIN user_changes uc LEFT JOIN dz_devices_current d ON uc.device_pk = d.pk WHERE (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) GROUP BY ts.time, d.code) SELECT time, device as \"Device\", CAST(user_count AS DOUBLE) as \"User Count\" FROM active_users ORDER BY time, \"Device\"",
          "refId": "A"
        }
      ],
      "title": "DoubleZero User Count Over Time by Device",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Device"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": true,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 35
      },
      "id": 21,
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "WITH time_series AS (SELECT date_trunc('hour', generate_series) as time FROM generate_series(CAST($__timeFrom() AS TIMESTAMP), CAST($__timeTo() AS TIMESTAMP) + INTERVAL '1 hour', INTERVAL '1 hour')), validator_users AS (SELECT DISTINCT u.pk, u.kind, u.status, u.device_pk, u.owner_pubkey, u.dz_ip, u.valid_from, COALESCE(u.valid_to, CAST('9999-12-31' AS TIMESTAMP)) as valid_to FROM dz_users_history u JOIN solana_gossip_nodes_history gn ON u.dz_ip = gn.gossip_ip AND gn.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (gn.valid_to IS NULL OR gn.valid_to >= CAST($__timeFrom() AS TIMESTAMP)) JOIN solana_vote_accounts_history va ON gn.pubkey = va.node_pubkey WHERE u.op != 'D' AND (u.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (u.valid_to IS NULL OR u.valid_to >= CAST($__timeFrom() AS TIMESTAMP))) AND va.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (va.valid_to IS NULL OR va.valid_to >= CAST($__timeFrom() AS TIMESTAMP)) AND va.epoch_vote_account = true AND va.activated_stake_lamports > 0 AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE u.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END)), active_validators AS (SELECT ts.time, COALESCE(d.code, 'unknown') as device, COUNT(DISTINCT CASE WHEN vu.valid_from <= ts.time AND vu.valid_to > ts.time AND vu.status = 'activated' AND EXISTS (SELECT 1 FROM solana_gossip_nodes_history gn2 JOIN solana_vote_accounts_history va2 ON gn2.pubkey = va2.node_pubkey WHERE gn2.gossip_ip = vu.dz_ip AND gn2.valid_from <= ts.time AND (gn2.valid_to IS NULL OR gn2.valid_to > ts.time) AND va2.valid_from <= ts.time AND (va2.valid_to IS NULL OR va2.valid_to > ts.time) AND va2.epoch_vote_account = true AND va2.activated_stake_lamports > 0) THEN vu.pk END) as validator_count FROM time_series ts CROSS JOIN validator_users vu LEFT JOIN dz_devices_current d ON vu.device_pk = d.pk WHERE (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) GROUP BY ts.time, d.code) SELECT time, device as \"Device\", CAST(validator_count AS DOUBLE) as \"Validator Count\" FROM active_validators ORDER BY time, \"Device\"",
          "refId": "A"
        }
      ],
      "title": "Solana Validators on DZ Over Time by Device",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "doublezero-lake"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 10,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "showValues": false,
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Device"
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": true,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 35
      },
      "id": 22,
      "options": {
        "legend": {
          "calcs": [
            "mean",
            "lastNotNull"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.3.1",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "editorMode": "code",
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "WITH time_series AS (SELECT date_trunc('hour', generate_series) as time FROM generate_series(CAST($__timeFrom() AS TIMESTAMP), CAST($__timeTo() AS TIMESTAMP) + INTERVAL '1 hour', INTERVAL '1 hour')), gossip_only_users AS (SELECT DISTINCT u.pk, u.kind, u.status, u.device_pk, u.owner_pubkey, u.dz_ip, u.valid_from, COALESCE(u.valid_to, CAST('9999-12-31' AS TIMESTAMP)) as valid_to, COALESCE(d.code, 'unknown') as device_code FROM dz_users_history u JOIN solana_gossip_nodes_history gn ON u.dz_ip = gn.gossip_ip AND gn.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (gn.valid_to IS NULL OR gn.valid_to >= CAST($__timeFrom() AS TIMESTAMP)) LEFT JOIN solana_vote_accounts_history va ON gn.pubkey = va.node_pubkey AND va.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (va.valid_to IS NULL OR va.valid_to >= CAST($__timeFrom() AS TIMESTAMP)) LEFT JOIN dz_devices_current d ON u.device_pk = d.pk WHERE u.op != 'D' AND (u.valid_from <= CAST($__timeTo() AS TIMESTAMP) AND (u.valid_to IS NULL OR u.valid_to >= CAST($__timeFrom() AS TIMESTAMP))) AND (va.vote_pubkey IS NULL OR va.epoch_vote_account = false OR va.activated_stake_lamports = 0) AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE u.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END)), active_gossip_only AS (SELECT ts.time, gou.device_code as device, COUNT(DISTINCT CASE WHEN gou.valid_from <= ts.time AND gou.valid_to > ts.time AND gou.status = 'activated' AND EXISTS (SELECT 1 FROM solana_gossip_nodes_history gn2 WHERE gn2.gossip_ip = gou.dz_ip AND gn2.valid_from <= ts.time AND (gn2.valid_to IS NULL OR gn2.valid_to > ts.time) AND NOT EXISTS (SELECT 1 FROM solana_vote_accounts_history va2 WHERE va2.node_pubkey = gn2.pubkey AND va2.valid_from <= ts.time AND (va2.valid_to IS NULL OR va2.valid_to > ts.time) AND va2.epoch_vote_account = true AND va2.activated_stake_lamports > 0)) THEN gou.pk END) as gossip_only_count FROM time_series ts CROSS JOIN gossip_only_users gou GROUP BY ts.time, gou.device_code) SELECT time, device as \"Device\", CAST(gossip_only_count AS DOUBLE) as \"Gossip-Only Count\" FROM active_gossip_only ORDER BY time, \"Device\"",
          "refId": "A"
        }
      ],
      "title": "Solana Gossip-Only Nodes on DZ Over Time by Device",
      "type": "timeseries"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 43
      },
      "id": 101,
      "panels": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Kind"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by User Type",
                        "url": "d/${__dashboard.uid}?var-user_type=${__value.text}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Status"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by Status",
                        "url": "d/${__dashboard.uid}?var-status=${__value.text}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Device"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by Device",
                        "url": "d/${__dashboard.uid}?var-device=${__value.text}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Metro"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by Metro",
                        "url": "d/${__dashboard.uid}?var-metro=${__value.text}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Contributor"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by Contributor",
                        "url": "d/${__dashboard.uid}?var-contributor=${__value.text}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Owner PK"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by Owner PK",
                        "url": "d/${__dashboard.uid}?var-owner_pubkey=${__value.raw}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Avg In Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Peak In Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Avg Out Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Peak Out Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 188
          },
          "id": 14,
          "options": {
            "cellHeight": "sm",
            "enablePagination": true,
            "showHeader": true,
            "sortBy": []
          },
          "pluginVersion": "12.3.1",
          "targets": [
            {
              "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT DISTINCT u.pk as \"User PK\", u.owner_pubkey as \"Owner PK\", u.kind as \"Kind\", u.status as \"Status\", u.client_ip as \"Client IP\", u.dz_ip as \"DZ IP\", d.code as \"Device\", m.code as \"Metro\", c.code as \"Contributor\", u.tunnel_id as \"Tunnel ID\", joined.valid_from as \"Join Date\", CAST(EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - joined.valid_from)) / 86400.0 AS DOUBLE) as \"Age (days)\", COALESCE(throughput.avg_in_throughput, 0) as \"Avg In Throughput (bps)\", COALESCE(throughput.peak_in_throughput, 0) as \"Peak In Throughput (bps)\", COALESCE(throughput.avg_out_throughput, 0) as \"Avg Out Throughput (bps)\", COALESCE(throughput.peak_out_throughput, 0) as \"Peak Out Throughput (bps)\" FROM dz_users_current u LEFT JOIN dz_devices_current d ON u.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk LEFT JOIN solana_gossip_nodes_current gn ON u.dz_ip = gn.gossip_ip LEFT JOIN (SELECT pk, MIN(valid_from) as valid_from FROM dz_users_history WHERE op = 'I' GROUP BY pk) joined ON u.pk = joined.pk LEFT JOIN (SELECT usr.pk, AVG(u.in_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as avg_in_throughput, MAX(u.in_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as peak_in_throughput, AVG(u.out_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as avg_out_throughput, MAX(u.out_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as peak_out_throughput FROM dz_device_interface_counters_raw u JOIN dz_users_current usr ON u.device_pk = usr.device_pk AND u.user_tunnel_id = usr.tunnel_id WHERE u.time >= $__timeFrom() AND u.time <= $__timeTo() AND u.delta_duration > 0 AND u.in_octets_delta >= 0 AND u.out_octets_delta >= 0 GROUP BY usr.pk) throughput ON throughput.pk = u.pk WHERE (gn.pubkey IS NULL OR gn.pubkey NOT IN (SELECT node_pubkey FROM solana_vote_accounts_current WHERE epoch_vote_account = true AND activated_stake_lamports > 0)) AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE u.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END) ORDER BY u.pk",
              "refId": "A"
            }
          ],
          "title": "Non-Solana Users",
          "type": "table"
        },
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Kind"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by User Type",
                        "url": "d/${__dashboard.uid}?var-user_type=${__value.text}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Status"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by Status",
                        "url": "d/${__dashboard.uid}?var-status=${__value.text}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Device"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by Device",
                        "url": "d/${__dashboard.uid}?var-device=${__value.text}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Metro"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by Metro",
                        "url": "d/${__dashboard.uid}?var-metro=${__value.text}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Contributor"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by Contributor",
                        "url": "d/${__dashboard.uid}?var-contributor=${__value.text}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Owner PK"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by Owner PK",
                        "url": "d/${__dashboard.uid}?var-owner_pubkey=${__value.raw}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Avg In Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Peak In Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Avg Out Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Peak Out Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 196
          },
          "id": 15,
          "options": {
            "cellHeight": "sm",
            "enablePagination": true,
            "showHeader": true,
            "sortBy": []
          },
          "pluginVersion": "12.3.1",
          "targets": [
            {
              "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT u.pk as \"User PK\", u.owner_pubkey as \"Owner PK\", u.kind as \"Kind\", u.status as \"Status\", u.client_ip as \"Client IP\", u.dz_ip as \"DZ IP\", gn.pubkey as \"Node Pubkey\", CASE WHEN va.activated_stake_lamports IS NOT NULL THEN CAST(va.activated_stake_lamports / 1000000000.0 AS DOUBLE) ELSE NULL END as \"Stake (SOL)\", d.code as \"Device\", m.code as \"Metro\", c.code as \"Contributor\", u.tunnel_id as \"Tunnel ID\", joined.valid_from as \"Join Date\", CAST(EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - joined.valid_from)) / 86400.0 AS DOUBLE) as \"Age (days)\", CASE WHEN gn.tpuquic_ip IS NOT NULL AND gn.tpuquic_port IS NOT NULL AND gn.tpuquic_port > 0 THEN gn.tpuquic_ip || ':' || CAST(gn.tpuquic_port AS VARCHAR) ELSE NULL END as \"TPU-QUIC Address\", COALESCE(throughput.avg_in_throughput, 0) as \"Avg In Throughput (bps)\", COALESCE(throughput.peak_in_throughput, 0) as \"Peak In Throughput (bps)\", COALESCE(throughput.avg_out_throughput, 0) as \"Avg Out Throughput (bps)\", COALESCE(throughput.peak_out_throughput, 0) as \"Peak Out Throughput (bps)\" FROM dz_users_current u JOIN solana_gossip_nodes_current gn ON u.dz_ip = gn.gossip_ip JOIN solana_vote_accounts_current va ON gn.pubkey = va.node_pubkey LEFT JOIN dz_devices_current d ON u.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk LEFT JOIN (SELECT pk, MIN(valid_from) as valid_from FROM dz_users_history WHERE op = 'I' GROUP BY pk) joined ON u.pk = joined.pk LEFT JOIN (SELECT usr.pk, AVG(u.in_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as avg_in_throughput, MAX(u.in_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as peak_in_throughput, AVG(u.out_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as avg_out_throughput, MAX(u.out_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as peak_out_throughput FROM dz_device_interface_counters_raw u JOIN dz_users_current usr ON u.device_pk = usr.device_pk AND u.user_tunnel_id = usr.tunnel_id WHERE u.time >= $__timeFrom() AND u.time <= $__timeTo() AND u.delta_duration > 0 AND u.in_octets_delta >= 0 AND u.out_octets_delta >= 0 GROUP BY usr.pk) throughput ON throughput.pk = u.pk WHERE va.epoch_vote_account = true AND va.activated_stake_lamports > 0 AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE u.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END) ORDER BY CASE WHEN va.activated_stake_lamports IS NOT NULL THEN va.activated_stake_lamports ELSE 0 END DESC, u.pk",
              "refId": "A"
            }
          ],
          "title": "Solana Validators",
          "type": "table"
        },
        {
          "datasource": {
            "type": "postgres",
            "uid": "doublezero-lake"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "footer": {
                  "reducers": []
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Kind"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by User Type",
                        "url": "d/${__dashboard.uid}?var-user_type=${__value.text}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Status"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by Status",
                        "url": "d/${__dashboard.uid}?var-status=${__value.text}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Device"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by Device",
                        "url": "d/${__dashboard.uid}?var-device=${__value.text}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Metro"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by Metro",
                        "url": "d/${__dashboard.uid}?var-metro=${__value.text}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Contributor"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by Contributor",
                        "url": "d/${__dashboard.uid}?var-contributor=${__value.text}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Owner PK"
                },
                "properties": [
                  {
                    "id": "links",
                    "value": [
                      {
                        "title": "Filter by Owner PK",
                        "url": "d/${__dashboard.uid}?var-owner_pubkey=${__value.raw}"
                      }
                    ]
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Avg In Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Peak In Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Avg Out Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Peak Out Throughput (bps)"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "bps"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 204
          },
          "id": 16,
          "options": {
            "cellHeight": "sm",
            "enablePagination": true,
            "showHeader": true,
            "sortBy": []
          },
          "pluginVersion": "12.3.1",
          "targets": [
            {
              "datasource": {
                "type": "postgres",
                "uid": "doublezero-lake"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT u.pk as \"User PK\", u.owner_pubkey as \"Owner PK\", u.kind as \"Kind\", u.status as \"Status\", u.client_ip as \"Client IP\", u.dz_ip as \"DZ IP\", gn.pubkey as \"Node Pubkey\", d.code as \"Device\", m.code as \"Metro\", c.code as \"Contributor\", u.tunnel_id as \"Tunnel ID\", joined.valid_from as \"Join Date\", CAST(EXTRACT(EPOCH FROM (CURRENT_TIMESTAMP - joined.valid_from)) / 86400.0 AS DOUBLE) as \"Age (days)\", CASE WHEN gn.tpuquic_ip IS NOT NULL AND gn.tpuquic_port IS NOT NULL AND gn.tpuquic_port > 0 THEN gn.tpuquic_ip || ':' || CAST(gn.tpuquic_port AS VARCHAR) ELSE NULL END as \"TPU-QUIC Address\", COALESCE(throughput.avg_in_throughput, 0) as \"Avg In Throughput (bps)\", COALESCE(throughput.peak_in_throughput, 0) as \"Peak In Throughput (bps)\", COALESCE(throughput.avg_out_throughput, 0) as \"Avg Out Throughput (bps)\", COALESCE(throughput.peak_out_throughput, 0) as \"Peak Out Throughput (bps)\" FROM dz_users_current u JOIN solana_gossip_nodes_current gn ON u.dz_ip = gn.gossip_ip LEFT JOIN solana_vote_accounts_current va ON gn.pubkey = va.node_pubkey LEFT JOIN dz_devices_current d ON u.device_pk = d.pk LEFT JOIN dz_metros_current m ON d.metro_pk = m.pk LEFT JOIN dz_contributors_current c ON d.contributor_pk = c.pk LEFT JOIN (SELECT pk, MIN(valid_from) as valid_from FROM dz_users_history WHERE op = 'I' GROUP BY pk) joined ON u.pk = joined.pk LEFT JOIN (SELECT usr.pk, AVG(u.in_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as avg_in_throughput, MAX(u.in_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as peak_in_throughput, AVG(u.out_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as avg_out_throughput, MAX(u.out_octets_delta * 8.0 / NULLIF(u.delta_duration, 0)) as peak_out_throughput FROM dz_device_interface_counters_raw u JOIN dz_users_current usr ON u.device_pk = usr.device_pk AND u.user_tunnel_id = usr.tunnel_id WHERE u.time >= $__timeFrom() AND u.time <= $__timeTo() AND u.delta_duration > 0 AND u.in_octets_delta >= 0 AND u.out_octets_delta >= 0 GROUP BY usr.pk) throughput ON throughput.pk = u.pk WHERE (va.vote_pubkey IS NULL OR va.epoch_vote_account = false OR va.activated_stake_lamports = 0) AND (CASE WHEN '${user_type:raw}' = '__ALL__' THEN true ELSE u.kind IN (SELECT unnest(string_to_array('${user_type:raw}', ','))) END) AND (CASE WHEN '${status:raw}' = '__ALL__' THEN true ELSE u.status IN (SELECT unnest(string_to_array('${status:raw}', ','))) END) AND (CASE WHEN '${device:raw}' = '__ALL__' THEN true ELSE (d.code IS NULL OR d.code IN (SELECT unnest(string_to_array('${device:raw}', ',')))) END) AND (CASE WHEN '${metro:raw}' = '__ALL__' THEN true ELSE (m.code IS NULL OR m.code IN (SELECT unnest(string_to_array('${metro:raw}', ',')))) END) AND (CASE WHEN '${contributor:raw}' = '__ALL__' THEN true ELSE (c.code IS NULL OR c.code IN (SELECT unnest(string_to_array('${contributor:raw}', ',')))) END) AND (CASE WHEN '${owner_pubkey:raw}' = '__ALL__' THEN true ELSE u.owner_pubkey IN (SELECT unnest(string_to_array('${owner_pubkey:raw}', ','))) END) ORDER BY u.pk",
              "refId": "A"
            }
          ],
          "title": "Solana Gossip-Only Nodes",
          "type": "table"
        }
      ],
      "title": "Full Listing Tables",
      "type": "row"
    }
  ],
  "preload": false,
  "refresh": "30m",
  "schemaVersion": 42,
  "tags": [
    "doublezero",
    "lake",
    "users"
  ],
  "templating": {
    "list": [
      {
        "allValue": "__ALL__",
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "datasource": {
          "type": "postgres",
          "uid": "doublezero-lake"
        },
        "definition": "SELECT DISTINCT kind FROM dz_users_current WHERE kind IS NOT NULL ORDER BY kind",
        "description": "Filter by user type",
        "includeAll": true,
        "label": "User Type",
        "multi": true,
        "name": "user_type",
        "options": [],
        "query": "SELECT DISTINCT kind FROM dz_users_current WHERE kind IS NOT NULL ORDER BY kind",
        "refresh": 1,
        "regex": "",
        "sort": 1,
        "type": "query"
      },
      {
        "allValue": "__ALL__",
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "datasource": {
          "type": "postgres",
          "uid": "doublezero-lake"
        },
        "definition": "SELECT DISTINCT status FROM dz_users_current WHERE status IS NOT NULL ORDER BY status",
        "description": "Filter by user status",
        "includeAll": true,
        "label": "Status",
        "multi": true,
        "name": "status",
        "options": [],
        "query": "SELECT DISTINCT status FROM dz_users_current WHERE status IS NOT NULL ORDER BY status",
        "refresh": 1,
        "regex": "",
        "sort": 1,
        "type": "query"
      },
      {
        "allValue": "__ALL__",
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "datasource": {
          "type": "postgres",
          "uid": "doublezero-lake"
        },
        "definition": "SELECT DISTINCT d.code FROM dz_users_current u JOIN dz_devices_current d ON u.device_pk = d.pk WHERE d.code IS NOT NULL ORDER BY d.code",
        "description": "Filter by device",
        "includeAll": true,
        "label": "Device",
        "multi": true,
        "name": "device",
        "options": [],
        "query": "SELECT DISTINCT d.code FROM dz_users_current u JOIN dz_devices_current d ON u.device_pk = d.pk WHERE d.code IS NOT NULL ORDER BY d.code",
        "refresh": 1,
        "regex": "",
        "sort": 1,
        "type": "query"
      },
      {
        "allValue": "__ALL__",
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "datasource": {
          "type": "postgres",
          "uid": "doublezero-lake"
        },
        "definition": "SELECT DISTINCT m.code FROM dz_users_current u JOIN dz_devices_current d ON u.device_pk = d.pk JOIN dz_metros_current m ON d.metro_pk = m.pk WHERE m.code IS NOT NULL ORDER BY m.code",
        "description": "Filter by metro",
        "includeAll": true,
        "label": "Metro",
        "multi": true,
        "name": "metro",
        "options": [],
        "query": "SELECT DISTINCT m.code FROM dz_users_current u JOIN dz_devices_current d ON u.device_pk = d.pk JOIN dz_metros_current m ON d.metro_pk = m.pk WHERE m.code IS NOT NULL ORDER BY m.code",
        "refresh": 1,
        "regex": "",
        "sort": 1,
        "type": "query"
      },
      {
        "allValue": "__ALL__",
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "datasource": {
          "type": "postgres",
          "uid": "doublezero-lake"
        },
        "definition": "SELECT DISTINCT c.code FROM dz_users_current u JOIN dz_devices_current d ON u.device_pk = d.pk JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE c.code IS NOT NULL ORDER BY c.code",
        "description": "Filter by device contributor",
        "includeAll": true,
        "label": "Contributor",
        "multi": true,
        "name": "contributor",
        "options": [],
        "query": "SELECT DISTINCT c.code FROM dz_users_current u JOIN dz_devices_current d ON u.device_pk = d.pk JOIN dz_contributors_current c ON d.contributor_pk = c.pk WHERE c.code IS NOT NULL ORDER BY c.code",
        "refresh": 1,
        "regex": "",
        "sort": 1,
        "type": "query"
      },
      {
        "allValue": "__ALL__",
        "current": {
          "text": "All",
          "value": "$__all"
        },
        "datasource": {
          "type": "postgres",
          "uid": "doublezero-lake"
        },
        "definition": "SELECT DISTINCT owner_pubkey FROM dz_users_current WHERE owner_pubkey IS NOT NULL ORDER BY owner_pubkey",
        "description": "Filter by owner PK",
        "includeAll": true,
        "label": "Owner PK",
        "multi": true,
        "name": "owner_pubkey",
        "options": [],
        "query": "SELECT DISTINCT owner_pubkey FROM dz_users_current WHERE owner_pubkey IS NOT NULL ORDER BY owner_pubkey",
        "refresh": 1,
        "regex": "",
        "sort": 1,
        "type": "query"
      }
    ]
  },
  "time": {
    "from": "now-24h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "DoubleZero Users Overview",
  "uid": "doublezero-users-overview",
  "version": 157
}